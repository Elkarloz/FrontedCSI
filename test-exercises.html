<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test de Carga de Ejercicios</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #1a1a1a;
            color: #fff;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .info { color: #2196F3; }
        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #45a049; }
        pre {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            overflow-x: auto;
        }
    </style>
</head>
<body>
    <h1>üß™ Test de Carga de Ejercicios</h1>
    
    <div class="test-section">
        <h2>üì° Test de API Backend</h2>
        <button onclick="testBackendAPI()">Probar API Backend</button>
        <div id="backend-result"></div>
    </div>
    
    <div class="test-section">
        <h2>üéØ Test de Carga de Ejercicios</h2>
        <button onclick="testExerciseLoading()">Cargar Ejercicios del Nivel 19</button>
        <div id="exercise-result"></div>
    </div>
    
    <div class="test-section">
        <h2>üîç Debug de Datos</h2>
        <button onclick="debugExerciseData()">Debug Datos de Ejercicios</button>
        <div id="debug-result"></div>
    </div>

    <script>
        const API_BASE = 'http://localhost:5000';
        
        async function testBackendAPI() {
            const resultDiv = document.getElementById('backend-result');
            resultDiv.innerHTML = '<p class="info">üîÑ Probando conexi√≥n al backend...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/exercises/level/19`);
                const data = await response.json();
                
                if (data.success) {
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ Backend funcionando correctamente</p>
                        <p class="info">üìä Ejercicios encontrados: ${data.data.length}</p>
                        <pre>${JSON.stringify(data, null, 2)}</pre>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå Error del backend: ${data.message}</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error de conexi√≥n: ${error.message}</p>`;
            }
        }
        
        async function testExerciseLoading() {
            const resultDiv = document.getElementById('exercise-result');
            resultDiv.innerHTML = '<p class="info">üîÑ Cargando ejercicios...</p>';
            
            try {
                // Simular la carga como lo hace el frontend
                const response = await fetch(`${API_BASE}/api/exercises/level/19`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    const exercises = data.data;
                    
                    // Simular la transformaci√≥n que hace el controlador
                    const transformedExercises = exercises.map(exercise => ({
                        id: exercise.id,
                        title: exercise.question,
                        question: exercise.question,
                        type: exercise.type,
                        difficulty: exercise.difficulty,
                        points: exercise.points,
                        isCompleted: exercise.isCompleted || false,
                        timeLimit: exercise.timeLimit,
                        options: [
                            exercise.optionA,
                            exercise.optionB,
                            exercise.optionC,
                            exercise.optionD
                        ].filter(option => option && option.trim() !== ''),
                        correctAnswer: exercise.correctAnswer,
                        explanation: exercise.explanation,
                        levelId: exercise.levelId,
                        levelTitle: exercise.levelTitle,
                        planetTitle: exercise.planetTitle
                    }));
                    
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ Ejercicios cargados correctamente</p>
                        <p class="info">üìä Total: ${transformedExercises.length} ejercicios</p>
                        <div>
                            ${transformedExercises.map(ex => `
                                <div style="background: #333; padding: 10px; margin: 5px 0; border-radius: 4px;">
                                    <strong>${ex.title}</strong><br>
                                    <small>Tipo: ${ex.type} | Dificultad: ${ex.difficulty} | Puntos: ${ex.points}</small><br>
                                    <small>Opciones: ${ex.options.length}</small>
                                </div>
                            `).join('')}
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå No se encontraron ejercicios</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
        
        async function debugExerciseData() {
            const resultDiv = document.getElementById('debug-result');
            resultDiv.innerHTML = '<p class="info">üîÑ Analizando datos...</p>';
            
            try {
                const response = await fetch(`${API_BASE}/api/exercises/level/19`);
                const data = await response.json();
                
                if (data.success && Array.isArray(data.data)) {
                    const exercises = data.data;
                    const firstExercise = exercises[0];
                    
                    resultDiv.innerHTML = `
                        <p class="success">‚úÖ Datos analizados</p>
                        <h3>üîç Estructura del primer ejercicio:</h3>
                        <pre>${JSON.stringify(firstExercise, null, 2)}</pre>
                        
                        <h3>üìä Estad√≠sticas:</h3>
                        <ul>
                            <li>Total ejercicios: ${exercises.length}</li>
                            <li>Tipos √∫nicos: ${[...new Set(exercises.map(e => e.type))].join(', ')}</li>
                            <li>Dificultades: ${[...new Set(exercises.map(e => e.difficulty))].join(', ')}</li>
                            <li>Ejercicios con opciones: ${exercises.filter(e => e.optionA).length}</li>
                        </ul>
                    `;
                } else {
                    resultDiv.innerHTML = `<p class="error">‚ùå No hay datos para analizar</p>`;
                }
            } catch (error) {
                resultDiv.innerHTML = `<p class="error">‚ùå Error: ${error.message}</p>`;
            }
        }
    </script>
</body>
</html>
